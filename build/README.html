<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>Goblin Camp building guide</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="goblin-camp-building-guide">
<h1 class="title">Goblin Camp building guide</h1>

<p>This document describes the build system of <a class="reference external" href="http://goblincamp.com">Goblin Camp</a>.
If you haven't used new build system yet (introduced in <a class="reference external" href="http://bitbucket.org/genericcontainer/goblin-camp/changeset/5aa18bbb7b4d">changeset 5aa18bbb7b4d</a>),
you should read the entire document.</p>
<p>If you need more help, visit <a class="reference external" href="http://goblincamp.com/forum">our forums</a>.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#prerequisites" id="id5">Prerequisites</a><ul>
<li><a class="reference internal" href="#tools" id="id6">Tools</a></li>
<li><a class="reference internal" href="#dependencies" id="id7">Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#goblin-camp-build-system" id="id8">Goblin Camp build system</a><ul>
<li><a class="reference internal" href="#configuring-build" id="id9">Configuring build</a><ul>
<li><a class="reference internal" href="#id1" id="id10">Boost</a></li>
<li><a class="reference internal" href="#id2" id="id11">libtcod</a></li>
<li><a class="reference internal" href="#id3" id="id12">Windows SDK</a></li>
<li><a class="reference internal" href="#id4" id="id13">Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building" id="id14">Building</a></li>
<li><a class="reference internal" href="#variants" id="id15">Variants</a></li>
<li><a class="reference internal" href="#parallel-builds" id="id16">Parallel builds</a></li>
<li><a class="reference internal" href="#installing-to-dist" id="id17">Installing to dist</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-build-system-capabilities" id="id18">Additional build system capabilities</a><ul>
<li><a class="reference internal" href="#generating-msvc-project-files" id="id19">Generating MSVC project files</a></li>
<li><a class="reference internal" href="#generating-nsis-installer" id="id20">Generating NSIS installer</a></li>
<li><a class="reference internal" href="#automatic-versioning" id="id21">Automatic versioning</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="prerequisites">
<h1><a class="toc-backref" href="#id5">Prerequisites</a></h1>
<div class="section" id="tools">
<h2><a class="toc-backref" href="#id6">Tools</a></h2>
<p>Except for C++ compiler, you will need several tools to be able to build Goblin Camp.
Here's list with known working versions:</p>
<ul class="simple">
<li><a class="reference external" href="http://python.org/">Python</a> <strong>2.6.6</strong> or newer (<strong>not</strong> 3.x).</li>
<li><a class="reference external" href="http://sourceforge.net/projects/boost/files/boost-jam/3.1.18/">Boost.Jam</a> <strong>03.1.18</strong>.</li>
</ul>
</div>
<div class="section" id="dependencies">
<h2><a class="toc-backref" href="#id7">Dependencies</a></h2>
<p>Goblin Camp requires several third party libraries to build and link:</p>
<ul class="simple">
<li><a class="reference external" href="http://boost.org">Boost</a> <strong>1.44</strong> (or newer, but not earlier).</li>
<li><a class="reference external" href="http://doryen.eptalys.net/libtcod">libtcod</a> <strong>r483</strong> [must be later than <strong>r477</strong>: new API]
(GC uses not-yet-released SVN version — listed here is a known working revision).</li>
<li><a class="reference external" href="http://microsoft.com/downloads/details.aspx?FamilyID=6b6c21d2-2006-4afa-9702-529fa782d63b">Windows SDK</a> <strong>7.1</strong> (or newer; 7.0 may work as well, but older are not supported).</li>
<li><a class="reference external" href="http://python.org/">Python</a> <strong>2.6.6</strong> or <strong>2.7.x</strong> (3.x will not work).</li>
</ul>
</div>
</div>
<div class="section" id="goblin-camp-build-system">
<h1><a class="toc-backref" href="#id8">Goblin Camp build system</a></h1>
<div class="section" id="configuring-build">
<h2><a class="toc-backref" href="#id9">Configuring build</a></h2>
<p>Before you build GC, you'll need to create a configuration file for the build,
so that compiler can find all needed headers and libraries.</p>
<p>Minimal config file (let's call it <tt class="docutils literal"><span class="pre">gc-config.jam</span></tt>, put it into root directory of the source;
i.e. the one with Jamroot.jam) must have at least one <tt class="docutils literal">using</tt> directive: for the compiler:</p>
<pre class="literal-block">
using msvc ;
</pre>
<p>Build system requests specific Boost version to avoid breakages. In place of <tt class="docutils literal">msvc</tt> you can
use e.g. <tt class="docutils literal">gcc</tt> (on Linux) or <tt class="docutils literal">darwin</tt> (on OSX). You can further configure the compiler,
e.g. by giving it custom flags, but this is outside of this document's scope — see <a class="reference external" href="http://boost.org/doc/tools/build/doc/html/bbv2/reference/tools.html">Boost Build</a>
documentation instead.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id10">Boost</a></h3>
<p>If your Boost is not on standard compiler's search path (MSVC: and you don't have LIB/INCLUDE environment
variables set properly), you will need to provide them in config, in format:</p>
<pre class="literal-block">
using boost : 1.44 : properties ;
</pre>
<p>In properties field you can put:</p>
<ul>
<li><p class="first"><tt class="docutils literal">&lt;library&gt;path</tt> — path to libraries</p>
</li>
<li><p class="first"><tt class="docutils literal">&lt;include&gt;path</tt> — path to headers</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal">&lt;layout&gt;layout</tt> — same value you build Boost with:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal">&lt;layout&gt;system</tt> — if your Boost libraries <strong>don't have any</strong> tags in their name
(e.g. they all look like <tt class="docutils literal">libboost_thread.lib</tt>, or similar) — they need
to be built as multithreaded, with static linkage and dynamic runtime linkage!</li>
<li><tt class="docutils literal">&lt;layout&gt;tagged</tt> — if your Boost libraries <strong>have</strong> tags in their name, but
without compiler and version information (e.g. <tt class="docutils literal"><span class="pre">libboost_thread-mt-gd.lib</span></tt>).</li>
<li><tt class="docutils literal">&lt;layout&gt;versioned</tt> — if your Boost libraries have all tags in their names
(e.g. <tt class="docutils literal"><span class="pre">libboost_thread-vc90-mt-gd-1_43.lib</span></tt>).</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>See <a class="reference external" href="http://boost.org/doc/libs/1_43_0/more/getting_started/unix-variants.html#library-naming">Boost documentation</a> for more information about tags.</p>
<p>Example:</p>
<pre class="literal-block">
using boost : 1.44 : &lt;layout&gt;tagged ;
</pre>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id11">libtcod</a></h3>
<p>Same as with Boost, but the format is:</p>
<pre class="literal-block">
using libtcod : properties ;
</pre>
<p>Available properties:</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;library&gt;path</tt> — path to libraries</li>
<li><tt class="docutils literal">&lt;include&gt;path</tt> — path to headers</li>
<li><tt class="docutils literal"><span class="pre">&lt;debug-name&gt;lib-name</span> <span class="pre">&lt;release-name&gt;lib-name</span></tt> — library name for debug and release variants respectively.
If you don't provide these, build system will attempt to guess them (it will print <tt class="docutils literal">** Using libtcod: name</tt>).</li>
</ul>
<p>Example:</p>
<pre class="literal-block">
using libtcod : &lt;library&gt;C:\dev\libs\libtcod\lib &lt;include&gt;C:\dev\libs\libtcod\include ;
</pre>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id12">Windows SDK</a></h3>
<p>Format:</p>
<pre class="literal-block">
using winsdk : properties ;
</pre>
<p>Properties:</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;library&gt;path</tt> — path to libraries</li>
<li><tt class="docutils literal">&lt;include&gt;path</tt> — path to headers</li>
</ul>
<p>Example:</p>
<pre class="literal-block">
using winsdk : &lt;library&gt;C:\dev\libs\WinSDK\v7.1\Lib &lt;include&gt;C:\dev\libs\WinSDK\v7.1\Include ;
</pre>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id13">Python</a></h3>
<p>Format:</p>
<pre class="literal-block">
using python : properties ;
</pre>
<p>Properties:</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;library&gt;path</tt> — path to libraries</li>
<li><tt class="docutils literal">&lt;include&gt;path</tt> — path to headers</li>
<li><tt class="docutils literal">&lt;version&gt;version</tt> — Python version (major.minor; by default 2.7)</li>
<li><tt class="docutils literal">&lt;pydebug&gt;on</tt> — enable Python debugging (link to debug version of Python)</li>
<li><tt class="docutils literal">&lt;suffix&gt;suffix</tt> — library name suffix (_d is default for debug libs)</li>
</ul>
<p>Example:</p>
<pre class="literal-block">
using python : &lt;version&gt;2.7 &lt;library&gt;C:\dev\apps\Python27\libs &lt;include&gt;C:\dev\apps\Python27\include ;
</pre>
</div>
</div>
<div class="section" id="building">
<h2><a class="toc-backref" href="#id14">Building</a></h2>
<p>To build you need to run bjam:</p>
<pre class="literal-block">
bjam --user-config=gc-config.jam
</pre>
<p>This will build the default variant (debug), and <strong>not</strong> copy files into <tt class="docutils literal">dist</tt>.</p>
</div>
<div class="section" id="variants">
<h2><a class="toc-backref" href="#id15">Variants</a></h2>
<p>Goblin Camp can be built in two variants:</p>
<ul class="simple">
<li><tt class="docutils literal">debug</tt> — much slower, but more suitable for testing newest revisions.</li>
<li><tt class="docutils literal">release</tt> — intended for released versions, optimised and without debugging routines compiled in.</li>
</ul>
<p>To build selected variant append <tt class="docutils literal"><span class="pre">variant=&lt;name&gt;</span></tt> to the bjam invocation. You can build both at the
same time with <tt class="docutils literal">variant=release,debug</tt>.</p>
</div>
<div class="section" id="parallel-builds">
<h2><a class="toc-backref" href="#id16">Parallel builds</a></h2>
<p>If you have multicore CPU, you can run more than one compiler instance at the same time, to speed
the compilation up. To use this append <tt class="docutils literal"><span class="pre">-jN</span></tt> to bjam invocation, where N is number of parallel
processes.</p>
</div>
<div class="section" id="installing-to-dist">
<h2><a class="toc-backref" href="#id17">Installing to dist</a></h2>
<p>To run compiled game, you should install to dist first. To do this, append <tt class="docutils literal">dist</tt> to bjam invocation.
This will copy all data files and executables into <tt class="docutils literal"><span class="pre">build\dist\&lt;variant&gt;</span></tt> directory.</p>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p>Windows:</p>
<p class="last">If your PATH environment variable is not set correctly, you will need to manually copy
DLLs of libtcod and Boost into dist directory, or the game won't run. Currently
build system can only find and copy bundled dbghelp.dll (and it was a priority, because
crash handler depends on new version, and cannot run with OS-provided one).</p>
</div>
</div>
</div>
<div class="section" id="additional-build-system-capabilities">
<h1><a class="toc-backref" href="#id18">Additional build system capabilities</a></h1>
<div class="section" id="generating-msvc-project-files">
<h2><a class="toc-backref" href="#id19">Generating MSVC project files</a></h2>
<p>Build system can generate MSVC2008 and MSVC2010 solution and project.
To do this, use:</p>
<pre class="literal-block">
bjam --user-config=gc-config.jam sln2008
</pre>
<p>You can use <tt class="docutils literal">sln2010</tt> instead to generate MSVC2010 project.</p>
</div>
<div class="section" id="generating-nsis-installer">
<h2><a class="toc-backref" href="#id20">Generating NSIS installer</a></h2>
<p>There is NSIS installer template included with sources. To build it, you need
to run:</p>
<pre class="literal-block">
bjam --user-config=gc-config.jam nsis variant=release
</pre>
<p>Installer will be saved into <tt class="docutils literal">build\dist\installer</tt>.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">You cannot build NSIS installer with <tt class="docutils literal">variant=debug</tt>.</p>
</div>
</div>
<div class="section" id="automatic-versioning">
<h2><a class="toc-backref" href="#id21">Automatic versioning</a></h2>
<p>Build system generates _version.rc (on Windows) and _version.cpp from <tt class="docutils literal">GC_VERSION</tt>
constant defined in <tt class="docutils literal">Jamroot.jam</tt> and Mercurial revision ID (if it can be obtained).</p>
<p>This is done to reduce maintenance effort in bumping the GC version.</p>
</div>
</div>
</div>
</body>
</html>
